#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
. "$SCRIPT_DIR/../lib/common.sh"

require_cmd fail2ban-client

JAILS="$(run_f2b status | awk -F':' '/Jail list/{gsub(/^[ \t]+/, "", $2); gsub(/, */, " ", $2); print $2}')"

if [[ -z "$JAILS" ]]; then
  _yellow "No jails found."
  exit 0
fi

for jail in $JAILS; do
  _green "=== Jail: $jail ==="
  run_f2b status "$jail"
  echo
done
